!function(t){"use strict";var i=function(i,e){this.options=e,this.table=i,this.currentPage=0,this.currentStart=0,this.filterIndex=[],this.options.nbColumns<0&&(this.options.nbColumns=this.table.find("thead tr").first().find("th").length),t(this.options.pagingDivSelector).addClass("pagination-datatables").addClass(this.options.pagingDivClass);var s=t("<ul></ul>");s.addClass(this.options.pagingListClass),t(this.options.pagingDivSelector).html("").append(s);var a=this;if(0===this.table.find("thead").length){var n=t("<thead></thead>");n.append(this.table.find("th").parent("tr")),this.table.prepend(n)}if(0===this.table.find("tbody").length&&t("<tbody></tbody>").insertAfter(this.table.find("thead").first()),t.isArray(this.options.data))this.data=this.options.data;else if(t.isPlainObject(this.options.data))if(this.table.data("size")&&(this.options.data.size=parseInt(this.table.data("size"),10)),void 0===this.options.data.timeout&&(this.options.data.timeout=2e3),void 0===this.options.data.refresh&&(this.options.data.refresh=!1),this._timeout=-1,this.data=[],void 0!==this.options.data.size){t(this.options.loadingDivSelector).html('<div class="progress progress-striped active datatable-load-bar"><div class="bar" style="width: 0%;"></div></div>');for(var r=0;r<this.options.data.size;r+=this.options.pageSize*this.options.pagingNumberOfPages)this.getAjaxDataAsync(r)}else t(this.options.loadingDivSelector).html('<div class="progress progress-striped active datatable-load-bar"><div class="bar" style="width: 100%;"></div></div>'),this.getAjaxDataSync();else if(this.data=[],this.table.find("tbody tr").each(function(){var i=[];t(this).find("td").each(function(){i.push(t(this).html())}),a.data.push(i)}),!this.options.forceStrings&&this.data.length)for(var o=0;o<this.data[0].length;++o){for(var h=!0,r=0;r<this.data.length;++r)t.isNumeric(this.data[r][o])||(h=!1);if(h)for(var r=0;r<this.data.length;++r)this.data[r][o]=parseFloat(this.data[r][o])}this.createSort(),this.createFilter()};i.prototype={constructor:i,clearAjaxLoading:function(){this.options.data.refresh&&(this.refreshTimeOut=setTimeout(function(t){return function(){t.getAjaxDataSync(0,!0)}}(this),this.options.data.refresh))},hideLoadingDivs:function(){this.getLoadingDivs().remove()},updateLoadingDivs:function(){this.data.length===this.options.data.size?(this.clearAjaxLoading(),this.hideLoadingDivs()):this.getLoadingDivs().find("div.progress .bar").css("width",parseInt(100*this.data.length/this.options.data.size,10)+"%")},getAjaxDataAsync:function(i){t.ajax({url:this.options.data.url,type:this.options.data.type,data:{offset:i,limit:this.options.pageSize*this.options.pagingNumberOfPages},ajaxI:i,ajaxThis:this,success:function(t){this.ajaxThis.data=this.ajaxThis.data.concat(t),this.ajaxThis.updateLoadingDivs(),clearTimeout(this.ajaxThis._timeout),this.ajaxThis.data.length===this.ajaxThis.options.data.size?this.ajaxThis.sort(!0):this.ajaxThis._timeout=setTimeout(function(t){return function(){t._timeout=-1,t.sort(!0)}}(this.ajaxThis),1e3)},error:function(t,i,e){switch(t.status){case 404:case 500:console.log("ERROR: "+e+" - "+i),console.log(t);break;default:this.ajaxThis.getAjaxDataAsync(this.ajaxI)}},timeout:this.options.data.timeout})},getAjaxDataSync:function(i,e){"undefined"==typeof i&&(i=0),"undefined"==typeof e&&(e=!1),e&&void 0===this.syncData&&(this.syncData=[]),t.ajax({url:this.options.data.url,type:this.options.data.type,data:{offset:i,limit:this.options.pageSize*this.options.pagingNumberOfPages},ajaxI:i,ajaxAllInOne:e,ajaxThis:this,success:function(t){0!==t.length?(this.ajaxAllInOne?this.ajaxThis.syncData=this.ajaxThis.syncData.concat(t):(this.ajaxThis.data=this.ajaxThis.data.concat(t),this.ajaxThis.sort(!0)),this.ajaxThis.getAjaxDataSync(this.ajaxI+this.ajaxThis.options.pageSize*this.ajaxThis.options.pagingNumberOfPages,this.ajaxAllInOne)):(this.ajaxAllInOne&&(this.ajaxThis.data=this.ajaxThis.syncData,delete this.ajaxThis.syncData),this.ajaxThis.clearAjaxLoading(),this.ajaxThis.hideLoadingDivs(),this.ajaxThis.sort(!0))},error:function(t,i,e){switch(t.status){case 404:case 500:console.log("ERROR: "+e+" - "+i),console.log(t);break;default:this.ajaxThis.getAjaxDataSync(this.ajaxI,this.ajaxAllInOne)}},timeout:this.options.data.timeout})},getHead:function(){return this.table.find("thead").first()},getBody:function(){return this.table.find("tbody").first()},getCounter:function(){return t(this.options.counterDivSelector)},getLoadingDivs:function(){return t(this.options.loadingDivSelector)},getPagingLists:function(){return t(this.options.pagingDivSelector).find("ul")},getLastPageNumber:function(){return parseInt(Math.ceil(this.filterIndex.length/this.options.pageSize),10)},updatePaging:function(){var i,e,s=this.options.pagingNumberOfPages,a=this,n=parseInt(this.currentStart/this.options.pageSize,10)+1,r=this.getLastPageNumber();s/2>n?i=1:n>=r-s/2?(i=r-s+1,1>i&&(i=1)):i=parseInt(n-s/2+1,10),e=r+1>i+s?i+s-1:r,this.getPagingLists().each(function(){t(this).html(""),a.options.firstPage&&t(this).append('<li class="'+(1===n?"active":"")+'"><a data-page="first">'+a.options.firstPage+"</a></li>"),a.options.prevPage&&t(this).append('<li class="'+(1===n?"active":"")+'"><a data-page="prev">'+a.options.prevPage+"</a></li>");for(var s=i;e>=s;s++)t(this).append('<li class="'+(s===n?"active":"")+'"><a data-page="'+s+'">'+s+"</a></li>");a.options.nextPage&&t(this).append('<li class="'+(n===r||0===r?"active":"")+'"><a data-page="next">'+a.options.nextPage+"</a></li>"),a.options.lastPage&&t(this).append('<li class="'+(n===r||0===r?"active":"")+'"><a data-page="last">'+a.options.lastPage+"</a></li>")}),this.getPagingLists().find("a").on("click.datatable",function(){if(!t(this).parent("li").hasClass("active")){var i=t(this).data("page");switch(i){case"first":a.loadPage(1);break;case"prev":a.loadPage(n-1);break;case"next":a.loadPage(n+1);break;case"last":a.loadPage(r);break;default:a.loadPage(parseInt(i,10))}}})},updateCounter:function(){var t=this.filterIndex.length?parseInt(this.currentStart/this.options.pageSize,10)+1:0,i=parseInt(Math.ceil(this.filterIndex.length/this.options.pageSize),10),e=this.filterIndex.length?this.currentStart+1:0,s=this.currentStart+this.options.pageSize>this.filterIndex.length?this.filterIndex.length:this.currentStart+this.options.pageSize;this.getCounter().html(this.options.counterText.call(this.table,t,i,e,s,this.filterIndex.length,this.data.length))},getSortFunction:function(){if(this.options.sort===!1)return!1;if(t.isFunction(this.options.sort))return this.options.sort;if(0===this.data.length||!(this.options.sortKey in this.data[0]))return!1;var i=this.options.sortKey,e="asc"===this.options.sortDir;return t.isFunction(this.options.sort[i])?function(t){return function(s,a){var n=s[i],r=a[i];return e?t(n,r):-t(n,r)}}(this.options.sort[i]):function(t,s){var a=t[i],n=s[i];return a>n?e?1:-1:n>a?e?-1:1:0}},destroyFilter:function(){t(".datatable-filter-line").remove()},changePlaceHolder:function(){var i=this.options.filterText?this.options.filterText:"";t('.datatable-filter-line input[type="text"]').attr("placeholder",i)},createTextFilter:function(i){var e=this.options.filters[i],s=e instanceof t?e:t('<input type="text" />');this.options.filterText&&s.attr("placeholder",this.options.filterText),s.addClass("datatable-filter datatable-input-text"),s.attr("data-filter",i),this.filterVals[i]="";var a=function(){var t=0;return function(i,e){clearTimeout(t),t=setTimeout(i,e)}}();s.on("keyup keydown",function(i){return function(){var e=t(this).val().toUpperCase(),s=t(this).data("filter");a(function(){i.filterVals[s]=e,i.filter()},300)}}(this));var n="regexp"===e||s.attr("data-regexp");return t.isFunction(e)?this.addFilter(i,e):n?this.addFilter(i,function(t,i){return new RegExp(i).test(String(t))}):this.addFilter(i,function(t,i){return-1!==String(t).toUpperCase().indexOf(i)}),s.addClass(this.options.filterInputClass),s},_isIn:function(t,i){for(var e=!1,s=0;s<i.length&&!e;++s)e=i[s]==t;return e},_index:function(t,i){if(void 0===i||null===i)return-1;for(var e=-1,s=0;s<i.length&&-1==e;++s)i[s]===t&&(e=s);return e},_keys:function(t){if(void 0===t||null===t)return void 0;var i=[];for(var e in t)t.hasOwnProperty(e)&&i.push(e);return i},createSelectFilter:function(i){var e=this.options.filters[i],s={},a=[],n=!1,r=!0,o=this.options.filterEmptySelect,h=!1;if(e instanceof t?h=e:t.isPlainObject(e)&&"element"in e&&e.element&&(h=e.element),e instanceof t||"select"===e)s=this.getFilterOptions(i);else if(n="multiple"in e&&e.multiple===!0,r="empty"in e&&e.empty,o="empty"in e&&"string"==typeof e.empty?e.empty:this.options.filterEmptySelect,"values"in e){if(s="auto"===e.values?this.getFilterOptions(i):e.values,"default"in e)a=e["default"];else if(n){a=[];for(var l in s)t.isPlainObject(s[l])?a=a.concat(this._keys(s[l])):a.push(l)}else a=[];t.isArray(a)||(a=[a])}else s=e,a=n?this._keys(s):[];var d=h?h:t("<select></select>");n&&d.attr("multiple","multiple"),e["default"]&&d.attr("data-default",e["default"]),d.addClass("datatable-filter datatable-select"),d.attr("data-filter",i),r&&d.append('<option value="" data-empty="true">'+o+"</option>");var f=[];for(var p in s)if(t.isPlainObject(s[p])){var c=t('<optgroup label="'+p+'"></optgroup>');for(var u in s[p])s[p].hasOwnProperty(u)&&(f.push(u),c.append('<option value="'+u+'" '+(this._isIn(u,a)?"selected":"")+">"+s[p][u]+"</option>"));d.append(c)}else f.push(p),d.append('<option value="'+p+'" '+(this._isIn(p,a)?"selected":"")+">"+s[p]+"</option>");var g=d.val();return this.filterVals[i]=n?g:r&&!g?f:[g],d.change(function(i,e,s,a){return function(){var n=t(this).val(),r=t(this).data("filter");a.filterVals[r]=e?n:s&&!n?i:[n],a.filter()}}(f,n,r,this)),t.isPlainObject(e)&&"function"==typeof e.fn?(this.addFilter(i,e.fn),d.data("filterType","function")):(this.addFilter(i,function(t,i){return function(e,s){return s?s!=t||e?i._isIn(e,s):!0:!1}}(f,this)),d.data("filterType","default")),d.addClass(this.options.filterSelectClass),d},createFilter:function(){if(this.filters=[],this.filterTags=[],this.filterVals=[],this.options.filters){var i=t('<tr class="datatable-filter-line"></tr>');for(var e in this.options.filters)if(this.options.filters.hasOwnProperty(e)){var s=t("<td></td>");if(this.options.filters[e]!==!1){var a=this.options.filters[e],n=a===!0||"regexp"===a||"input"===a||t.isFunction(a)||a instanceof t&&a.is("input"),r=n?this.createTextFilter(e):this.createSelectFilter(e);this.filterTags[e]=r,r.parents("html").length||(s.addClass("datatable-filter-cell"),s.append(r))}i.append(s)}i.find("td.datatable-filter-cell").length>0&&i.insertAfter(this.table.find("thead tr").last())}},filter:function(i){"undefined"==typeof i&&(i=!1);var e=this.currentStart;this.currentStart=0,this.filterIndex=[];for(var s=0;s<this.data.length;s++)this.checkFilter(this.data[s])&&this.filterIndex.push(s);if(i){for(this.currentStart=e;this.currentStart>=this.filterIndex.length;)this.currentStart-=this.options.pageSize;this.currentStart<0&&(this.currentStart=0)}if(this.options.filterSelectOptions&&this.filterIndex.length>0){for(var a=this,n=[],r=0;r<this.data[0].length;++r)n.push({});for(var s=0;s<this.filterIndex.length;++s)for(var o=this.data[this.filterIndex[s]],r=0;r<o.length;++r)n[r][o[r]]=!0;for(var h=0;h<n.length;++h){var l=this._keys(n[h]);this.filterTags[h]&&this.filterTags[h].is("select")&&"default"==this.filterTags[h].data("filterType")&&(this.filterTags[h].find("option:not([data-empty])").hide(),this.filterTags[h].find("option").filter(function(){return a._isIn(t(this).val(),l)}).show())}}this.refresh()},resetFilters:function(){var i=this;t.each(this.filterTags,function(e,s){var a=s.data("filter");if(s.is("input"))s.val(""),i.filterVals[a]="";else if(s.attr("multiple")){var n=[];s.find("option").each(function(){t(this).attr("selected","selected"),n.push(t(this).val())}),i.filterVals[a]=n}else if(s.data("default")&&s.find('option[value="'+s.data("default")+'"]').length>0)s.find("option").attr("selected",!1),s.find('option[value="'+s.data("default")+'"]').attr("selected","selected"),i.filterVals[a]=[s.data("default")];else if(s.find("option").length>0)if(s.find("option").attr("selected",!1),s.find("option").first().attr("selected","selected"),s.find("option").first().data("empty")){var n=[];s.find("option").each(function(){t(this).data("empty")||n.push(t(this).val())}),i.filterVals[a]=n}else i.filterVals[a]=[s.find("option").first().val()]}),this.filter()},isHtml:function(i){if("string"!=typeof i)return!1;var e=!1;try{e=t(i).is("*")}catch(s){e=!1}return e},checkFilter:function(i){var e=!0;for(var s in this.filters){var a=i[s];if(this.isHtml(a)&&(a=t(a).text()),!this.filters[s](a,this.filterVals[s])){e=!1;break}}return e},addFilter:function(t,i){this.filters[t]=i},getFilterOptions:function(i){var e={},s=[];for(var a in this.data)""!==this.data[a][i]&&s.push(this.data[a][i]);s.sort();for(var n in s)if(s.hasOwnProperty(n))if(this.isHtml(s[n])){var r=t(s[n]).text();e[r]=r}else e[s[n]]=s[n];return e},destroySort:function(){t("thead th").removeClass("sorting sorting-asc sorting-desc").unbind("click.datatable").removeData("sort")},createSort:function(){var i=this;if(!t.isFunction(this.options.sort)){var e=0;this.table.find("thead th").each(function(){if(t(this).data("sort"))i.options.sort=!0;else if("*"===i.options.sort)t(this).data("sort",e);else{var s;t.isArray(i.options.sort)?s=e:t.isPlainObject(i.options.sort)&&(s=i._keys(i.options.sort)[e]),void 0!==s&&i.options.sort[s]&&t(this).data("sort",s)}void 0!==t(this).data("sort")&&t(this).addClass("sorting"),e++}),this.table.find("thead th").on("click.datatable",function(){void 0!==t(this).data("sort")&&(t(this).hasClass("sorting-asc")?(i.options.sortDir="desc",t(this).removeClass("sorting-asc").addClass("sorting-desc")):t(this).hasClass("sorting-desc")?(i.options.sortDir="asc",t(this).removeClass("sorting-desc").addClass("sorting-asc")):(t(this).parent("tr").find("th").removeClass("sorting-desc").removeClass("sorting-asc"),i.options.sortDir="asc",i.options.sortKey=t(this).data("sort"),t(this).addClass("sorting-asc")),i.sort(),i.refresh())})}},triggerSort:function(){if(t.isFunction(this.options.sort))this.sort(),this.refresh();else if(this.options.sortKey!==!1){var i;this.table.find("tr th").removeClass("sorting-desc").removeClass("sorting-asc"),this.table.find("th").each(function(e){return function(){t(this).data("sort")===e&&(i=t(this))}}(this.options.sortKey)),void 0!==i&&(i.addClass("sorting-"+this.options.sortDir),this.sort(),this.refresh())}},sort:function(t){var i=this.getSortFunction();i!==!1&&(this.data.sort(i),this.filter(t))},identify:function(i,e){return this.options.identify===!1?!1:t.isFunction(this.options.identify)?this.options.identify(i,e):e[this.options.identify]==i},indexOf:function(t){for(var i=-1,e=0;e<this.data.length&&-1===i;e++)this.identify(t,this.data[e])&&(i=e);return i},row:function(t){return this.options.identify===!0?this.data[t]:this.data[this.indexOf(t)]},all:function(){return this.data},addRow:function(t){this.data.push(t),this.sort(),this.filter(),this.currentStart=parseInt(this._index(this._index(t,this.data),this.filterIndex)/this.options.pageSize,10)*this.options.pageSize,this.refresh()},deleteRow:function(t){var i=this.currentStart,e=this.indexOf(t);return-1===e?void console.log("No data found with id: "+t):(this.data.splice(e,1),this.filter(),i<this.filterIndex.length?this.currentStart=i:(this.currentStart=i-this.options.pageSize,this.currentStart<0&&(this.currentStart=0)),void this.refresh())},updateRow:function(t,i){var e=this.indexOf(t);if(-1!==e){t in i&&delete i[t];for(var s in this.data[e])s in i&&(this.data[e][s]=i[s]);this.sort(),this.filter(),this.currentStart=parseInt(this._index(this.indexOf(t),this.filterIndex)/this.options.pageSize,10)*this.options.pageSize,this.refresh()}},loadPage:function(t){var i=this.currentStart/this.options.pageSize;1>t?t=1:t>this.getLastPageNumber()&&(t=this.getLastPageNumber()),this.currentStart=(t-1)*this.options.pageSize,this.refresh(),this.options.onChange.call(this.table,i+1,t)},getCurrentPage:function(){return this.currentStart/this.options.pageSize+1},refresh:function(){if(this.options.beforeRefresh.call(this.table),this.updatePaging(),this.updateCounter(),this.getBody().html(""),this.currentStart>=this.currentDataLength)return void this.getBody().append('<tr><td colspan="'+this.options.nbColumns+'"><div class="progress progress-striped active"><div class="bar" style="width: 100%;"></div></div></div></tr>');for(var t=0;t<this.options.pageSize&&t+this.currentStart<this.filterIndex.length;t++)this.getBody().append(this.options.lineFormat.call(this.table,this.filterIndex[this.currentStart+t],this.data[this.filterIndex[this.currentStart+t]]));this.options.afterRefresh.call(this.table)},setOption:function(t,i){t in this.options&&(this.options[t]=i,"sort"===t&&(this.destroySort(),this.createSort(),this.triggerSort()),("sortKey"===t||"sortDir"===t)&&this.sort(),"filters"===t&&(this.destroyFilter(),this.createFilter()),"filterText"===t&&this.changePlaceHolder(),this.filter())},setOptions:function(t){for(var i in t)i in this.options&&(this.options[i]=t[i]);"sort"in t?(this.destroySort(),this.createSort(),this.triggerSort()):("sortKey"in t||"sortDir"in t)&&this.sort(),"filters"in t&&(this.destroyFilter(),this.createFilter()),"filterText"in t&&this.changePlaceHolder(),this.filter()},destroy:function(){void 0!==this.refreshTimeOut&&clearTimeout(this.refreshTimeOut),this.destroySort(),t(this.options.pagingDivSelector).removeClass(this.options.pagingDivClass).removeClass("pagination-datatable").html(""),this.destroyFilter(),this.table.removeClass(this.options.tableClass),this.getBody().html("");for(var i=0;i<this.data.length;i++)this.getBody().append(this.options.lineFormat(i,this.data[i]))}},t.fn.datatable=function(){var e,s=arguments,a=-1;return 0===s.length&&(s=[{}]),e=this.each(function(){if(t.isPlainObject(s[0]))void 0===this.datatable?(this.datatable=new i(t(this),t.extend({},t.fn.datatable.defaults,s[0])),this.datatable.triggerSort(),this.datatable.filter()):this.datatable.setOptions(s[0]);else if("string"==typeof s[0])switch(s[0]){case"page":1 in s?this.datatable.loadPage(parseInt(s[1])):a=this.datatable.getCurrentPage();break;case"reset-filters":this.datatable.resetFilters();break;case"select":a=1 in s?this.datatable.row(s[1]):this.datatable.all();break;case"insert":this.datatable.addRow(s[1]);break;case"update":this.datatable.updateRow(s[1],s[2]);break;case"delete":this.datatable.deleteRow(s[1]);break;case"option":this.datatable.setOption(s[1],s[2]);break;case"refresh":this.datatable.refresh();break;case"destroy":this.datatable.destroy(),delete this.datatable}}),-1!==a?a:e},t.fn.datatable.defaults={forceStrings:!1,tableClass:"datatable",pagingDivSelector:".paging",pagingDivClass:"pagination pagination-centered",pagingListClass:"",counterDivSelector:".counter",loadingDivSelector:".loading",sort:!1,sortKey:!1,sortDir:"asc",nbColumns:-1,pageSize:20,pagingNumberOfPages:9,identify:!1,onChange:function(){},counterText:function(t,i,e,s,a,n){var r="Page "+t+" on "+i+". Showing "+e+" to "+s+" of "+a+" entries";return a!=n&&(r+=" (filtered from "+n+" total entries)"),r+="."},firstPage:"<<",prevPage:"<",nextPage:"&gt;",lastPage:"&gt;&gt;",filters:{},filterText:"Search... ",filterEmptySelect:"",filterSelectOptions:!1,filterInputClass:"",filterSelectClass:"",beforeRefresh:function(){},afterRefresh:function(){},lineFormat:function(i,e){var s=t("<tr></tr>");s.data("id",i);for(var a in e)e.hasOwnProperty(a)&&s.append("<td>"+e[a]+"</td>");return s}}}(window.jQuery);